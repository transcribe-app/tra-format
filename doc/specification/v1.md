# TRA Format specification v1.0

--- NOTES ---

// разделы/стилистика
// - по аналогии с https://www.topografix.com/gpx.asp
// - https://tron-format.github.io/

// design choices/rationale
// - archive format
// - 2-char json tags, float 2+2 chars = min json size
// - mime = little overhead but readable txt, default extractors
// // возможность извлечь данные без посторонних программ (mime defaults)
// - mime = учет особенностей под стриминг, с минимумом оверхеда. необязательный

// mime headers - name, lang, etc
// duration = double
// pre-chunks TXT - суммари
// first json chunk = delta, all chunks of same name
// first audio chunk = audio, all chunks of same name
// File ".json" or type "application/json", grouped/merged by file name = delta
// File ".mp3" or type "audio/basic" or type "application/octet-stream", grouped/merged by file name = audio
// - first audio = main

// JSON - delta, описание
// - Paragraph-based, Speaker separation, Word-level timestamps, Confidence
// - doc: параметры документа
// // "doc":"json_v2"
// // "tm": (timestamps mode) word/char в doc, для mp3
// // - default word, implied space между словами
// // xxx ln, язык гуглоформат - в хедерах уже
// - вставка картинок между параграфами
// - поддержка форматирования - на уровне VTT
// // align, size, color, font, bold, italic, striked
// - ph: опция he header - вместо sp/etc defaults (в мп3 album/имя трека)
// // ts","te" optional, ts<0 - ok
// // sp - 1+
// - wr: "ts","te" optional ("te" до начала next wr)

// MP3/TS - аудио, видео
// - strimmed/full

// стриминг - аудио
// - деление на отдельные чанки
// // xxx есть ли в mime автосклейка при совпадении имен файлов?
// // если замена - то нужна отдельная поддержка чанкования
// // важно чтобы после ручного разделения можно было склеить дефолтными средствами
// // content type message/partial ->7bit only -> base64 only -> nope
// - отдельные файлы со схемой наименования для объединения последовательностей
// - same name = OK! куча одноименных файлов - не проблема. нумерация и таймстампы отдельными параметрами - по ним мерж
// // нумерация с 1
// // ms-timestamp первого семпла - от начала стриминга! чтобы можно было сопоставлять с текстом тайминги

// стриминг - текст
// - чанкинг JSON - тоже схема наименования, нумерация с 1?
// - ph-id - уникальный id параграфа, в стриминге параграф МОЖЕТ ПРИХОДИТЬ несколько раз - исправляя параграф под номером
// // для реалтайма, где текст исправляется задним числом нередко, параграф может "уточняться"
// // при приходе параграфа уже имеющегося на клиенте - все words далее него в параграфе сбрасываются для перезаполенения